# Cветовой меч на Arduino
* [Описание проекта](#chapter-0)
* [Папки проекта](#chapter-1)
* [Схемы подключения](#chapter-2)
* [Материалы и компоненты](#chapter-3)
* [Как скачать и прошить](#chapter-4)
* [Сборка и настройка](#chapter-7)

<a id="chapter-0"></a>
## Описание проекта
Многоцветный световой меч на адресных светодиодах с воспроизведением звуков
#### ВОЗМОЖНОСТИ:
* Плавное включение/выключение со звуками меча
* Во время работы меч "пульсирует" случайным образом
* Во время работы издаёт звуки:
  + РЕЖИМ 1: тон "гудения" зависит от угловой скорости (гироскоп) поворота меча, т.е. взмаха
  + РЕЖИМ 2: гудение и звуки взмахов воспроизводятся с карты памяти
    - Медленный взмах - длинный звук взмаха (случайно один из 4)
    - Быстрый взмах - короткий звук взмаха (случайно один из 5)
* При ударе меч вспыхивает ярко-белым
* При ударе воспроизводится один из 16 звуков удара (случайно)
  + Слабый удар - короткие звуки
  + Сильный удар - длинные звуки
* При включении показывает уровень заряда аккумулятора длиной светящейся части в процентах
* Следит за напряжением аккумулятора:
  + Аккумулятор разрядился ДО ВКЛЮЧЕНИЯ: меч не включится, светодиод кнопки мигнёт несколько раз
  + Аккумулятор разрядился ВО ВРЕМЯ РАБОТЫ: меч выключается
#### УПРАВЛЕНИЕ:
* Включение/выключение по удерживанию кнопки
* Тройное нажатие - смена цвета (красный - зелёный - синий - жёлтый - розовый - голубой)
* Пятерное нажатие - смена звукового режима (режим генерации и режим звуков с карты памяти)
* Выбранный цвет и режим хранится в памяти и не сбрасывается при перезагрузке  

Подробности в видео: 

<a id="chapter-1"></a>
## Папки
- **libraries** - библиотеки проекта. Заменить имеющиеся версии
- **GyverSaber** - прошивка для Arduino
- **schemes** - схемы подключения
- **SDsounds** - набор звуков для карты памяти

<a id="chapter-2"></a>
## Схемы
![SCHEME](https://github.com/netkot/GyverSaber/blob/master/schemes/scheme1.jpg)
![SCHEME](https://github.com/netkot/GyverSaber/blob/master/schemes/scheme2.jpg)

<a id="chapter-4"></a>
## Как скачать и прошить
* Скачать архив с проектом
> На главной странице проекта (где ты читаешь этот текст) вверху справа зелёная кнопка **Clone or download**, вот её жми, там будет **Download ZIP**
* Установить библиотеки в  
`C:\Program Files (x86)\Arduino\libraries\` (Windows x64)  
`C:\Program Files\Arduino\libraries\` (Windows x86)
* Подключить Ардуино к компьютеру
* Запустить файл прошивки (который имеет расширение .ino)
* Настроить IDE (COM порт, модель Arduino, как в статье выше)
* Настроить что нужно по проекту
* Нажать загрузить
* Пользоваться  

<a id="chapter-7"></a>
## Сборка и настройка
* Открыть прошивку, настроить:
  - Число МИКРОСХЕМ на ленте (чёрные штуки такие. **Одна микросхема отвечает за 3 светодиода**). Если вы захотите сделать меч длиннее - без проблем, главное не забыть это настроить.
  - Включить или выключить мерцание клинка (для эпилептиков)
  - ЖЕЛАТЕЛЬНО измерить реальное сопротивление резисторов делителя и тоже их указать (в Омах)
    + Если вы не ставите делитель, то нужно отключить параметр BATTERY_SAFE. Но делать это крайне не рекомендую!
  - Остальные настройки - полная кастомизация поведения меча, описания настроек говорят сами за себя. По умолчанию настроено так, как понравилось мне
* Загрузить прошивку
* Информация по MicroSD карте:
  - Размер до 4 Гб
  - Форматировать в FAT
  - Скопировать аудиофайлы В КОРЕНЬ карты
  - Если хотите добавить свои файлы, то нужно конвертировать в формат .wav со следующими параметрами:
    + 8 bit
    + 16-32 kHz
    + Mono
    + Для конвертации есть онайлн сервисы, а есть софтина Total Audio Converter
* Собрать всё по схеме
  - **ВНИМАНИЕ!** Если прошивается/отлаживается ПОЛНОСТЬЮ СОБРАННЫЙ МЕЧ, то нужно включить питание, иначе Ардуина будет постоянно перезагружаться! Это связано с питанием, так как у нас висит преобразователь.
* Включить и пользоваться!

## Настройки меча в прошивке
    NUM_LEDS 30         // число МИКРОСХЕМ на ленте
    BTN_TIMEOUT 800     // задержка кнопки для удерживания (миллисекунды)
    BRIGHTNESS 255      // максимальная яркость ленты (0 - 255)

    SWING_TIMEOUT 500   // таймаут между двумя взмахами
    SWING_L_THR 150     // порог угловой скорости для взмаха
    SWING_THR 300       // порог угловой скорости для сильного взмаха
    STRIKE_THR 150      // порог ускорения для распознавания удара
    STRIKE_S_THR 320    // порог ускорения для распознавания сильного удара
    FLASH_DELAY 80      // время вспышки при ударе (миллисекунды)

    BLINK_ALLOW 1       // разрешить мерцание (1 - разрешить, 0 - запретить)
    BLINK_AMPL 20       // амплитуда мерцания клинка
    BLINK_DELAY 30      // задержка между мерцаниями

    R1 100000           // сопротивление резистора делителя    
    R2 51000            // сопротивление резистора делителя
    BATTERY_SAFE 1      // не включаться и выключаться при низком заряде АКБ

    DEBUG 0             // вывод в порт отладочной информации
